<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Basic Widget Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 8px;
    }
    h1 {
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Basic Widget Test</h1>
    <p>This page tests the RAG Assistant widget with mocked API responses.</p>
    <div id="status">Loading widget...</div>
  </div>

  <!-- Mock fetch before loading widget -->
  <script>
    // Store original fetch
    const originalFetch = window.fetch;
    
    // Mock fetch for API calls
    window.fetch = function(url, options) {
      const urlStr = typeof url === 'string' ? url : url.toString();
      
      // Mock session creation
      if (urlStr.includes('/sessions') && options?.method === 'POST') {
        return Promise.resolve({
          ok: true,
          status: 200,
          json: () => Promise.resolve({
            sessionId: 'test_session_' + Date.now(),
            success: true
          })
        });
      }
      
      // Mock session history
      if (urlStr.includes('/sessions/') && urlStr.includes('/history')) {
        return Promise.resolve({
          ok: true,
          status: 200,
          json: () => Promise.resolve([])
        });
      }
      
      // Mock chat endpoint
      if (urlStr.includes('/chat')) {
        return Promise.resolve({
          ok: true,
          status: 200,
          json: () => Promise.resolve({
            answer: 'This is a test response from the mocked API.',
            recommendations: [],
            executionTime: 100
          })
        });
      }
      
      // Fall back to original fetch for other requests
      return originalFetch(url, options);
    };
  </script>

  <!-- RAG Assistant Widget - loaded from webpack dev server -->
  <script src="/main.js"></script>
  <script>
    try {
      const assistant = new RAGAssistant({
        merchantId: 'test_merchant',
        apiKey: 'test_key',
        apiBaseUrl: 'http://localhost:3000',
        theme: {
          primaryColor: '#007bff',
          position: 'bottom-right'
        },
        behavior: {
          autoOpen: false,
          greeting: 'Hello! How can I help you?',
          placeholder: 'Type your message...'
        }
      });
      
      window.assistantInstance = assistant;
      
      // Update status after a short delay
      setTimeout(() => {
        const statusEl = document.getElementById('status');
        if (document.getElementById('rag-widget-toggle')) {
          statusEl.textContent = '✓ Widget loaded successfully!';
          statusEl.style.color = 'green';
        } else {
          statusEl.textContent = '✗ Widget failed to load';
          statusEl.style.color = 'red';
        }
      }, 2000);
      
    } catch (error) {
      console.error('Widget initialization error:', error);
      document.getElementById('status').textContent = '✗ Error: ' + error.message;
      document.getElementById('status').style.color = 'red';
    }
  </script>
</body>
</html>
